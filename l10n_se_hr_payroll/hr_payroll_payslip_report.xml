<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <report id="l10n_se_hr_payroll.payslip" model="hr.payslip" string="Payslip SE" report_type="qweb-pdf" name="l10n_se_hr_payroll.payslip_report" file="l10n_se_hr_payroll.payslip_report" attachment_use="True" attachment="('payslip_'+(object.number.replace('/','') if object.number else ''))+'.pdf'" />
        <template id="payslip_report">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-raw="translate_doc(o.id, doc_model, 'employee_id.address_home_id.lang', 'l10n_se_hr_payroll.payslip_document')" />
                </t>
            </t>
        </template>
        <template id="payslip_document">
            <t t-call="report.external_layout">
                <div class="page">
                    <h2 t-field="o.name" />
                    <!--
                         SALARY LINES
                    -->
                    <div style="height: 650px;">
                        <table class="table table-condensed">
                            <thead>
                                <tr>
                                    <th>Löneart</th>
                                    <th>Kod</th>
                                    <th>Namn</th>
                                    <th style="text-align: right;">Kvantitet</th>
                                    <th style="text-align: right;">Antal</th>
                                    <th style="text-align: center;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="o.line_ids.filtered(lambda l: l.appears_on_payslip == True)" t-as="p">
                                    <tr t-att-style="'background: #eee;' if p.code == 'sum' else ''">
                                        <td>
                                            <span>
                                                <t t-esc="'%4s' %p.salary_rule_id.salary_art if p.salary_rule_id.salary_art else ''" />
                                            </span>
                                        </td>
                                        <td>
                                            <span>
                                                <t t-esc="p.code" />
                                            </span>
                                        </td>
                                        <td>
                                            <span t-field="p.name" />
                                        </td>
                                        <td style="text-align: right;">
                                            <t t-if="not p.quantity == 1 and not p.rate == 100">
                                                <span t-esc="'%2.2f' % (p.quantity * p.rate / 100)" />
                                            </t>
                                            <t t-if="not (not p.quantity == 1 and not p.rate == 100)">
                                                <t t-if="not p.quantity == 1">
                                                    <span t-esc="'%2.2f' % p.quantity" />
                                                </t>
                                                <t t-if="not p.rate == 100">
                                                    <span t-esc="'%2.2f%s' % (p.rate,'%')" />
                                                </t>
                                            </t>
                                        </td>
                                        <td style="text-align: right;">
                                            <t t-if="not p.quantity == 1 or not p.rate == 100">
                                                <span t-raw="'%s%2.2f' % ( '-&amp;nbsp;' if p.category_id.code == 'BRUAVG' or p.category_id.code == 'NETAVG' else '', p.amount)" />
                                            </t>
                                        </td>
                                        <td style="text-align: right;">
                                            <b t-if="p.code == 'sum'">
                                                <span t-field="p.total" t-field-options='{"widget": "monetary", "display_currency": "p.company_id.currency_id"}' />
                                            </b>
                                            <t t-if="not p.code == 'sum'">
                                                <t t-if="p.category_id.code == 'BRUAVG' or p.category_id.code == 'NETAVG'">-</t>
                                                <span t-field="p.total" t-field-options='{"widget": "monetary", "display_currency": "p.company_id.currency_id"}' />
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                    <div id="footer_table_div" class="col-md-12 col-sm-12 col-xs-12" style="padding: 0px;">
                        <table class="table table-sm table-bordered table-responsive" style="margin: 0px;">
                            <tbody>
                                <tr id="table_row_one">
                                    <td id="tidssaldon"/>
                                    <td id="salary_balance"/>
                                    <td>
                                        <span style="font-size: 0.7em;">Arbetsgivaravgift</span><br/>
                                        <span class="pull-left">Enlig avtal</span>
                                        <span class="pull-right"><t t-esc="o.get_slip_line_acc('san')" /></span>
                                    </td>
                                </tr>
                                <tr id="table_row_two">
                                    <td id="salary_accumulators" class="col-md-6 col-sm-6 col-xs-6">
                                        <span style="font-size: 0.7em;">Ackumulerad</span><br/>
                                        <span class="pull-left">Bruttolön</span><span class="pull-right"><t t-esc="o.get_slip_line_acc('bl')" /></span><br/>
                                        <span class="pull-left">Förmån</span><span class="pull-right"></span><br/>
                                        <span class="pull-left">Preliminärskatt</span><span class="pull-right"><t t-esc="o.get_slip_line_acc('(san-skv)')" /></span>
                                    </td>
                                    <td class="col-md-6 col-sm-6 col-xs-6">
                                        <span style="font-size: 0.7em;">Skatt beräknad på</span><br/>
                                        <span class="pull-left">Belopp</span><span class="pull-right"><t t-esc="o.contract_id.wage_tax_base" /></span><br/>
                                        <span class="pull-left">Skatt tabell</span><span class="pull-right"><t t-esc="o.contract_id.prel_tax_tabel" /></span><br/>
                                        <span class="pull-left">Preliminärskatt</span><span class="pull-right"><t t-esc="o.contract_id.prel_tax_amount" /></span>
                                    </td>
                                    <td/>
                                </tr>
                            </tbody>
                        </table>
                        <table id="holidays" class="table table-sm table-responsive" style="margin: 0px;">
                            <tbody>
                                <tr>
                                    <td class="col-md-1 col-sm-1 col-xs-1">
                                        <span style="font-size: 0.7em;">Årets semester</span>
                                    </td>
                                    <td class="col-md-11 col-sm-11 col-xs-11">
                                        <span style="font-size: 0.7em;">Sparad semester</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-1 col-sm-1 col-xs-1">
                                        <span style="font-size: 0.7em;">Betalda</span><br/>
                                        <span>0</span>
                                    </td>
                                    <td class="col-md-11 col-sm-11 col-xs-11">
                                        <br/>
                                        <span>0</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <table id="overall" class="table table-sm table-responsive" style="margin: 0px;">
                            <tbody>
                                <tr style="background: #eee;">
                                    <td><span style="font-size: 0.7em;">Arbetad tid</span></td>
                                    <td><span style="font-size: 0.7em;">Övertid</span></td>
                                    <td><span style="font-size: 0.7em;">Frånvaro</span></td>
                                </tr>
                                <tr style="background: #eee;">
                                    <td><t t-esc="o.worked_days_line_ids.filtered(lambda l: l.code == 'WORK100').mapped('number_of_hours')[0] or 0"/></td>
                                    <td><t t-esc="o.get_slip_line('kval')[0]['quantity'] or 0"/></td>
                                    <td>0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </t>
        </template>

        <template id="external_layout_header" inherit_id="report.external_layout_header" name="Inherit report header">
            <xpath expr="//div[@class='row'][last()]" position="replace">
                <div class="row">
                    <div class="col-xs-3">
                        <div t-field="company.partner_id"
                            t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'
                            style="border-bottom: 1px solid black;"/>
                    </div>
                </div>
            </xpath>
            <xpath expr="//div[@class='row'][last()]" position="inside">
                <div class="col-xs-4 col-xs-offset-2">
                    <span t-field="o.contract_id.name" /><br/>
                    <span t-field="o.employee_id.job_id" /><br/>
                    <span t-field="o.contract_id.working_hours" />
                </div>
                <div class="col-xs-3">
                    <div t-field="o.employee_id.address_home_id"
                        t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'
                        style="border-bottom: 1px solid black;"/>
                </div>
            </xpath>
        </template>
    </data>
</openerp>
